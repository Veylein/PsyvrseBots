# Render service definitions: split into a Python launcher and a Node service
# Deploy this repository to Render and Render will create two services:
#  - psyvrse-launcher (Python) runs the unified launcher
#  - psy-source (Node) runs the PsySource webhook bot

services:
  - type: worker
    name: psyvrse-launcher
    env: python
    plan: free
    root: .
    buildCommand: pip install -r requirements.txt
    startCommand: python main.py
    autoDeploy: true

  - type: web
    name: psy-source
    env: node
    plan: free
    root: PsySource
    # Prefer reproducible installs if you commit a package-lock.json
    # If you do NOT have a lockfile, Render will run `npm install` instead.
    buildCommand: npm ci --production --no-audit --no-fund || npm install --production --no-audit --no-fund
    startCommand: npm start
    autoDeploy: true

  # Pax and Ludus are lightweight worker bots; install dependencies from
  # the repository `requirements.txt` if available and run their start scripts.
  - type: worker
    name: pax-bot
    env: python
    plan: free
    root: Pax-Bot
    buildCommand: pip install -r requirements.txt || pip install -r ../requirements.txt || true
    startCommand: python start.py
    autoDeploy: true

  - type: worker
    name: ludus-bot
    env: python
    plan: free
    root: Ludus-Bot
    buildCommand: pip install -r requirements.txt || pip install -r ../requirements.txt || true
    startCommand: python start.py
    autoDeploy: true
